# Руководство пользователя one_c_swagger

## 1. Введение

`one_c_swagger` — это консольное приложение, предназначенное для автоматической генерации спецификаций OpenAPI 3.0 на основе исходных файлов конфигурации 1С:Предприятие и файлов-дополнений.

Приложение анализирует XML-файлы выгрузки HTTP-сервисов, объединяет их с данными из JSON-файлов дополнений и создает единую, консистентную спецификацию API в формате `openapi.json`.

![screen](/docs/images/img_1.png)

## 2. Настройка

Для работы приложения требуется конфигурационный файл `config.json`. Путь к этому файлу передается через флаг командной строки `-config`.

### Структура `config.json`

```json
{
    "log": {
        "log_path": "logs",
        "log_level": "DEBUG"
    },
    "project": {
        "configuration_path": "example/src/cf",
        "extensions_path": "example/src/cfe",
        "out_path": "example/out",
        "swagger_config_path": "example/swagger-configs",
        "all_services_config_filename": "all_services.json"
    }
}
```

- **log_path**: Путь к каталогу для хранения лог-файлов.
- **log_level**: Уровень детализации логов (`DEBUG`, `INFO`, `WARN`, `ERROR`).
- **configuration_path**: Путь к исходным файлам основной конфигурации 1С.
- **extensions_path**: Путь к каталогу с исходными файлами расширений 1С.
- **out_path**: Путь для сохранения итоговой спецификации `openapi.json`.
- **swagger_config_path**: Путь к каталогу с файлами-дополнениями.
- **all_services_config_filename**: Имя общего файла дополнений, который применяется ко всем сервисам.

## 3. Запуск

Для запуска приложения выполните команду:

```shell
one_c_swagger-windows-amd64.exe -config configs/config.json
```

или

```shell
one_c_swagger-linux-amd64 -config configs/config.json
```

## 4. Использование файлов-дополнений

Ключевой особенностью является возможность обогащения и переопределения автоматически сгенерированной спецификации с помощью JSON-файлов.

### Общий файл (`all_services.json`)

[Этот файл](/docs/example/swagger-configs/all_services.json) определяет общие для всех сервисов компоненты:

- **Глобальные схемы (`components.schemas`)**: Общие модели данных (например, `GenericError`).
- **Глобальные ответы (`components.responses`)**: Стандартные ответы (например, `default` или `404`), которые будут автоматически применены ко всем методам, если они не переопределены локально.
- **Глобальные заголовки (`components.headers`)**: Общие заголовки (например, CORS), которые автоматически добавляются во все ответы.
- **Глобальные параметры безопасности (`components.securitySchemes`)**.

### Файлы для конкретных сервисов (`ИмяСервиса.json`)

Для каждого HTTP-сервиса можно создать свой файл ([пример 1](/docs/example/swagger-configs/Биллинг.json), [пример 2](/docs/example/swagger-configs/TestServices.json)) дополнения в каталоге `swagger_config_path`. Имя файла должно совпадать с именем сервиса.

Этот файл позволяет:

1.  **Переопределять ответы**: Если в локальном файле для метода определен ответ с тем же кодом, что и в глобальном, будет использован локальный.
2.  **Определять локальные схемы**: Можно описать схемы, специфичные только для этого сервиса. Они будут автоматически переименованы (с добавлением префикса имени сервиса), чтобы избежать конфликтов с глобальными схемами или схемами из других сервисов.
3.  **"Затенять" глобальные схемы**: Если в локальном файле определить схему с тем же именем, что и у глобальной, то все ссылки (`$ref`) на эту схему **внутри этого же файла** будут указывать на локальную, переименованнную версию. Ссылки в других сервисах по-прежнему будут указывать на глобальную версию.
4.  **Определять специфичные для сервиса `security` и `servers`**.
